<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Admin - Board Game Spinner</title>
    <style>
      body{ font-family: Arial; padding:20px; background:#f3f4f6;}
      .card{ background:white; padding:16px; border-radius:8px; max-width:900px;}
      input, button{ padding:8px; margin:6px 0; }
      .games{ margin-top:12px;}
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Admin Login</h2>
      <label>Username<input id="u" /></label><br/>
      <label>Password<input id="p" type="password"/></label><br/>
      <button id="login">Login</button>
      <div id="msg"></div>
    </div>

    <div id="panel" style="display:none" class="card">
      <h2>Manage Games</h2>
      <div>
        <input id="gname" placeholder="Game name" />
        <button id="add">Add</button>
      </div>
      <div class="games" id="games"></div>
      <h3>Health</h3>
      <pre id="health">...</pre>
    </div>

    <script>
      let token = null;
      document.getElementById('login').onclick = async ()=>{
        const u = document.getElementById('u').value;
        const p = document.getElementById('p').value;
        const res = await fetch('/api/admin/login', {method:'POST', headers:{'content-type':'application/json'}, body:JSON.stringify({username:u,password:p})});
        const j = await res.json();
        if (j.token){ token = j.token; document.getElementById('panel').style.display='block'; fetchGames(); fetchHealth(); } else { document.getElementById('msg').textContent = JSON.stringify(j) }
      }
      async function fetchGames(){
        const res = await fetch('/api/admin/games', { headers: token? { Authorization: 'Bearer '+token } : {} });
        const j = await res.json();
        const el = document.getElementById('games'); el.innerHTML='';
        (j.games||[]).forEach(g=>{
          const d = document.createElement('div');
          d.textContent = g.name + ' ';
          const del = document.createElement('button'); del.textContent='Delete';
          del.onclick = async ()=> {
            await fetch('/api/admin/games', {method:'DELETE', headers:{'content-type':'application/json','authorization':'Bearer '+token}, body:JSON.stringify({id:g.id})});
            fetchGames();
          }
          d.appendChild(del);
          el.appendChild(d);
        })
      }
      document.getElementById('add').onclick = async ()=>{
        const name = document.getElementById('gname').value;
        await fetch('/api/admin/games', {method:'POST', headers:{'content-type':'application/json','authorization':'Bearer '+token}, body:JSON.stringify({name})});
        document.getElementById('gname').value='';
        fetchGames();
      }
      async function fetchHealth(){
        const r = await fetch('/api/health'); const j = await r.json();
        document.getElementById('health').textContent = JSON.stringify(j, null, 2);
      }
    </script>
  </body>
</html>